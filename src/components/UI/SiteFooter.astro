---
import Icon from "@components/Icons/Icon.astro";
import { companyDetails } from "@lib/siteData";

const year = new Date().getFullYear();
const baseHref = import.meta.env.BASE_URL;
const withTrailingSlash = (value) =>
  value.endsWith("/") ? value : `${value}/`;
const baseWithSlash = withTrailingSlash(baseHref);
const resolveHref = (path) => {
  if (path === "/" || path === "") {
    return baseWithSlash;
  }
  const normalized = path.startsWith("/") ? path.slice(1) : path;
  return `${baseWithSlash}${normalized}`;
};
const resolveAsset = (path) => {
  if (!path) {
    return "";
  }
  if (/^(?:[a-z+]+:)?\/\//i.test(path)) {
    return path;
  }
  const normalized = path.startsWith("/") ? path.slice(1) : path;
  return `${baseWithSlash}${normalized}`;
};

const primaryLogo = companyDetails.logos?.[0];
const logoSrc = primaryLogo ? resolveAsset(primaryLogo.source.src) : "";
const secondaryLogo = companyDetails.logos?.[1];
const secondaryLogoSrc = secondaryLogo
  ? resolveAsset(secondaryLogo.source.src)
  : "";
const addressLines = [
  companyDetails.address,
  `${companyDetails.zipCode} ${companyDetails.city}`.trim(),
  companyDetails.country,
].filter(Boolean);
const contactItems = companyDetails.contactItems ?? [];
const socialLinks = companyDetails.socialLinks ?? [];
---

<footer class="footer">
  <div class="footer__inner">
    <div class="footer__info">
      <p class="footer__brand">{companyDetails.name}</p>
      {
        addressLines.length > 0 && (
          <ul class="footer__address">
            {addressLines.map((line) => (
              <li>{line}</li>
            ))}
          </ul>
        )
      }
      {
        contactItems.length > 0 && (
          <ul class="footer__contacts">
            {contactItems.map((item) => (
              <li>
                <a class="footer__contact-link" href={item.href}>
                  <span class="footer__contact-icon" aria-hidden="true">
                    <Icon type={item.icon} size={20} />
                  </span>
                  <span>{item.label}</span>
                </a>
              </li>
            ))}
          </ul>
        )
      }
    </div>
    <div class="footer__badge" aria-hidden="true">
      {
        logoSrc && (
          <img src={logoSrc} alt={primaryLogo?.alt ?? "Logo"} loading="lazy" />
        )
      }
      {
        secondaryLogoSrc && (
          <img
            src={secondaryLogoSrc}
            alt={secondaryLogo?.alt ?? "Logo secondaire"}
            loading="lazy"
          />
        )
      }
    </div>
    {
      socialLinks.length > 0 && (
        <ul class="footer__social">
          {socialLinks.map((link) => (
            <li>
              <a
                href={link.href}
                aria-label={link.ariaLabel ?? link.name}
                target="_blank"
                rel="noopener noreferrer"
              >
                {link.icon ? <Icon type={link.icon} size={22} /> : link.name}
              </a>
            </li>
          ))}
        </ul>
      )
    }
  </div>
  <p class="footer__copyright">
    © {year}
    {companyDetails.name}.
    <span>
      <a class="footer__link" href={resolveHref("/mentions-legales")}>
        Mentions légales
      </a>
    </span>
  </p>
</footer>

<style lang="scss">
  .footer {
    background: var(--color-base-content);
    color: var(--color-base-100);
    padding: var(--space-3) var(--space-4);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: var(--space-3);

    :global(svg path) {
      fill: currentColor;
    }

    .footer__inner {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: var(--space-3);
    }

    .footer__info {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      font-size: 0.85rem;
      letter-spacing: 0.01em;

      .footer__brand {
        margin: 0;
        font-family: "Bold";
        font-size: clamp(0.95rem, 2.2vw, 1.1rem);
      }

      .footer__address {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;

        li {
          margin: 0;
        }
      }
    }

    .footer__contacts,
    .footer__social {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      gap: var(--space-2);
      justify-content: center;
    }

    .footer__contacts {
      flex-direction: column;
      gap: 0.5rem;

      .footer__contact-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: inherit;
        text-decoration: none;
        font-weight: 500;

        &:hover,
        &:focus-visible {
          color: var(--color-secondary);
        }
      }

      .footer__contact-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
    }

    .footer__badge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      flex-wrap: wrap;

      img {
        width: clamp(88px, 20vw, 110px);
        height: auto;
        display: block;
      }
    }

    .footer__social {
      gap: 1.25rem;

      a {
        color: inherit;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s ease;

        &:hover,
        &:focus-visible {
          color: var(--color-secondary);
        }
      }
    }

    .footer__copyright {
      margin: 0;
      font-size: 0.7rem;
      opacity: 0.6;
      text-align: center;

      .footer__link {
        margin-top: 0.25rem;
        color: inherit;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.75rem;

        &:hover {
          text-decoration: underline;
        }
      }
    }
  }

  @media (min-width: 960px) {
    .footer {
      flex-direction: column;

      .footer__inner {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        text-align: left;
        max-width: 960px;
        margin: 0 auto;
      }

      .footer__info {
        align-items: flex-start;
      }

      .footer__contacts {
        justify-content: flex-start;
        align-items: flex-start;
      }

      .footer__social {
        justify-content: flex-end;
      }

      .footer__copyright {
        max-width: 960px;
      }
    }
  }
</style>
